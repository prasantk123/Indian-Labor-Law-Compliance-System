{% extends "base.html" %}

{% block title %}Compliance Checker{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-10 mx-auto">
        <h2>Compliance Checklist Generator</h2>
        <p class="text-muted">Generate personalized compliance requirements for your establishment</p>
        
        <div class="card">
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="state" class="form-label">State *</label>
                                <select class="form-select" id="state" name="state" required>
                                    <option value="">Select State</option>
                                    <option value="Maharashtra" {{ 'selected' if state == 'Maharashtra' }}>Maharashtra</option>
                                    <option value="Karnataka" {{ 'selected' if state == 'Karnataka' }}>Karnataka</option>
                                    <option value="Tamil Nadu" {{ 'selected' if state == 'Tamil Nadu' }}>Tamil Nadu</option>
                                    <option value="Delhi" {{ 'selected' if state == 'Delhi' }}>Delhi</option>
                                    <option value="Gujarat" {{ 'selected' if state == 'Gujarat' }}>Gujarat</option>
                                    <option value="Rajasthan" {{ 'selected' if state == 'Rajasthan' }}>Rajasthan</option>
                                    <option value="West Bengal" {{ 'selected' if state == 'West Bengal' }}>West Bengal</option>
                                    <option value="Uttar Pradesh" {{ 'selected' if state == 'Uttar Pradesh' }}>Uttar Pradesh</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="num_employees" class="form-label">Number of Employees *</label>
                                <input type="number" class="form-control" id="num_employees" name="num_employees" 
                                       value="{{ num_employees or '' }}" required min="1">
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="industry_type" class="form-label">Industry Type *</label>
                                <select class="form-select" id="industry_type" name="industry_type" required>
                                    <option value="">Select Industry</option>
                                    <option value="Factory" {{ 'selected' if industry_type == 'Factory' }}>Factory</option>
                                    <option value="Shop" {{ 'selected' if industry_type == 'Shop' }}>Shop/Retail</option>
                                    <option value="IT" {{ 'selected' if industry_type == 'IT' }}>IT/Software</option>
                                    <option value="Services" {{ 'selected' if industry_type == 'Services' }}>Services</option>
                                    <option value="Manufacturing" {{ 'selected' if industry_type == 'Manufacturing' }}>Manufacturing</option>
                                    <option value="Trading" {{ 'selected' if industry_type == 'Trading' }}>Trading</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Generate Checklist</button>
                </form>
            </div>
        </div>
        
        {% if error %}
        <div class="alert alert-danger mt-3">{{ error }}</div>
        {% endif %}
        
        {% if checklist %}
        <div class="card result-card mt-3">
            <div class="card-body">
                <h5 class="card-title">Compliance Checklist</h5>
                <p class="text-muted">
                    For {{ industry_type }} in {{ state }} with {{ num_employees }} employees
                </p>
                
                <div class="alert alert-info">
                    <strong>Total Requirements: {{ checklist|length }}</strong>
                </div>
                
                <div class="checklist">
                    {% for item in checklist %}
                    <div class="form-check mb-2">
                        <input class="form-check-input" type="checkbox" id="item{{ loop.index }}">
                        <label class="form-check-label" for="item{{ loop.index }}">
                            {{ item }}
                        </label>
                    </div>
                    {% endfor %}
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-success btn-sm" onclick="printChecklist()">Print Checklist</button>
                    <button class="btn btn-info btn-sm" onclick="downloadChecklist()">Download as Text</button>
                    <a href="/download/compliance/pdf?state={{ state }}&num_employees={{ num_employees }}&industry_type={{ industry_type }}" class="btn btn-danger btn-sm">Download PDF Report</a>
                </div>
            </div>
        </div>
        {% endif %}
        
        <div class="card mt-3">
            <div class="card-body">
                <h6>Important Notes</h6>
                <ul class="small">
                    <li>This checklist is based on general compliance requirements</li>
                    <li>Specific requirements may vary based on local regulations</li>
                    <li>Consult with legal experts for complete compliance</li>
                    <li>Keep track of filing deadlines and renewal dates</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
function printChecklist() {
    window.print();
}

function downloadChecklist() {
    {% if checklist %}
    const checklist = {{ checklist|tojson }};
    const content = `Compliance Checklist for {{ industry_type }} in {{ state }} ({{ num_employees }} employees)\n\n` +
                   checklist.map((item, index) => `${index + 1}. ${item}`).join('\n');
    
    const blob = new Blob([content], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'compliance_checklist.txt';
    a.click();
    window.URL.revokeObjectURL(url);
    {% endif %}
}
</script>
{% endblock %}